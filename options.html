<!doctype html>
<html>
	<head>
		<title>Deezer Control Popup</title>
		<link type="text/css" rel="stylesheet" href="/css/options.css"/>
		<link type="text/css" rel="stylesheet" href="/css/large/popup.css" id="popup_style_css"/>
		<script src="/scripts/popup.js"></script>
		<script src="/scripts/i18n.js"></script>
		<script src="/scripts/localstorage.js"></script>
		<script type="text/javascript">
			var $ = function(str, el){ return (el || document).querySelector(str); },
			   $$ = function(str, el){ return (el || document).querySelectorAll(str); };
	
			// Saves options to localStorage.
			function saveStyle() 
			{
				var select = document.getElementById("popup_style");
				LOCSTO.popupStyle = select.children[select.selectedIndex].value;
				LOCSTO.saveOptions();
			
				// Update status to let user know options were saved.
				var status_style = document.getElementById("status_style");
				status_style.innerHTML = chrome.i18n.getMessage("options_page_tab_options_saved");
				setTimeout(function() { status_style.innerHTML = ""; }, 750);
			}
			
			function saveNotifications() 
			{
				LOCSTO.notifications.visible = $('#notifs_activate').checked;
				LOCSTO.notifications.alwaysOn = $('#notifs_always_visible').checked;
				LOCSTO.notifications.fadeAwayDelay = $('#notifs_fade_away_delay').value * 1000;
				LOCSTO.saveOptions();
			
				// Update status_style to let user know options were saved.
				var status_notifs = document.getElementById("status_notifs");
				status_notifs.innerHTML = chrome.i18n.getMessage("options_page_tab_options_saved");
				setTimeout(function() { status_notifs.innerHTML = ""; }, 750);
			}
		
			// Restores select box state to saved value from localStorage.
			function restore_options() 
			{
				//           Popup style
				//--------------------------------
				var aPopupStyle = LOCSTO.popupStyle;
				var select = document.getElementById("popup_style");
				for (var i = 0; i < select.children.length; i++) 
				{
					var child = select.children[i];
					if (child.value == aPopupStyle) 
					{
						child.selected = "true";
						break;
					}
				}
				loadStyle(); // from popup.js
				
				
				//        Notifications
				//--------------------------------
				$('#notifs_activate').checked = LOCSTO.notifications.visible;
				$('#notifs_always_visible').checked = LOCSTO.notifications.alwaysOn;
				$('#notifs_fade_away_delay').value = LOCSTO.notifications.fadeAwayDelay / 1000;
				
				showHideNotifsOptions(); // ensure options are correctly shown  
			}
		
			function loadStyleFromSelect()
			{
				var select = $("#popup_style");
				var aPopupStyle = select.children[select.selectedIndex].value;
				loadStyle(aPopupStyle); // from popup.js
			}
			
		    function showSection(id)
		    {
				var navItems = $$('#tab_chooser > nav > *'), sections = $$('#center_block > section');
				for(i = 0, l = navItems.length; i < l; i++)
				{
					navItems[i].className = navItems[i].className.replace(/\s?currentone/, '');
					sections[i].className = sections[i].className.replace(/\s?currentone/, '');
					if (sections[i].id == id)
					{
						navItems[i].className = navItems[i].className + ' currentone';
						sections[i].className = sections[i].className + ' currentone';
						$('#arrow_line > img').style.left = (159 * i + 73) + "px";
					}
				}
			}
		    
		    function resetSections()
		    {
				var navItems = $$('#tab_chooser > nav > a'), sections = $$('#center_block > section');
				navItems[0].className = navItems[0].className + ' currentone';
				sections[0].className = sections[0].className + ' currentone';
				if(location.hash)
				{
					showSection(location.hash.replace(/^\#/, ''));
				}
		    }
		    
		    function preparePage()
		    {
		    	restore_options(); 
		    	refreshPopup(); 
		    	resetSections(); 
		    	i18n.process(document);
		    	
		    	$("#rate_button").href = "https://chrome.google.com/webstore/detail/" + chrome.i18n.getMessage("@@extension_id");
		    }
		    
		    function checkNotifsPermission()
		    {
		    	if ($('#notifs_activate').checked == true)
	    		{
		    		chrome.permissions.request({ permissions: ['notifications'] }, function(granted) 
    				{
    		    		$('#notifs_activate').checked = granted;
	    		  	});	    		
	    		}
		    	
		    	showHideNotifsOptions();
		    }
		    
		    function showHideNotifsOptions()
		    {
		    	if ($('#notifs_activate').checked == true)
	    		{
		    		$('#notifs_always_visible').parentNode.style.display = 'block';
		    		$('#notifs_fade_away_delay').parentNode.style.display = 'block';
			    	
			    	if ($('#notifs_always_visible').checked == true)
			    		$('#notifs_fade_away_delay').parentNode.style.display = 'none';
			    	else 
			    		$('#notifs_fade_away_delay').parentNode.style.display = 'block';
	    		}
		    	else
		    	{
		    		$('#notifs_always_visible').parentNode.style.display = 'none';
		    		$('#notifs_fade_away_delay').parentNode.style.display = 'none';
		    	}
		    	
		    	$('#notifs_fade_away_delay_display').innerHTML = $('#notifs_fade_away_delay').value;
		    }
		    
		    window.addEventListener('hashchange', function(e) { showSection(location.hash.replace(/^\#/,'')); });
		</script>
	</head>

	<body onload="preparePage();">
		<div id="tab_chooser">
			<nav>
				<a id="welcome_nav" href="#welcome" i18n-content="options_page_tab_title_welcome"></a><a id="options_nav" href="#options" i18n-content="options_page_tab_title_options"></a><a id="notifications_nav" href="#notifications" i18n-content="options_page_tab_title_notifications"></a>
			</nav>
			<span id="arrow_line"><img src="imgs/arrow_down.png"/></span>
		</div>
			
		<div id="center_block">
		
			<!-- Option tab: welcome -->
			<section id="welcome">
				<h1 i18n-content="options_page_tab_welcome_h1"></h1>
				<div i18n-content="options_page_tab_welcome_content"></div>
				<div id="remember_to">
					<h2 i18n-content="options_page_tab_welcome_remember_to"></h2>
					<div><a id="rate_button" i18n-content="options_page_tab_welcome_rate_button" target="_blank"></a><span i18n-content="options_page_tab_welcome_rate_label"></span></div>
					<div><a i18n-content="options_page_tab_welcome_donate_button" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=K5THDKB5BN992" target="_blank"></a><span i18n-content="options_page_tab_welcome_donate_label"></span></div>
				</div>
				<div><span i18n-content="options_page_tab_welcome_contact_me_at"></span>: <a href="mailto:m520152112e@gmail.com" target="_blank">m520152112e@gmail.com</a></div>
			</section>
		
			<!-- Option tab: style chooser -->
			<section id="options">
				<h1 i18n-content="options_page_tab_options_h1_popup_style"></h1>
				<span i18n-content="options_page_tab_options_choose_style"></span>:
				<select id="popup_style" onchange="loadStyleFromSelect()">
		 			<option value="large" i18n-content="options_page_tab_options_style_large"></option>
		 			<option value="small" i18n-content="options_page_tab_options_style_small"></option>
		 			<option value="sideways" i18n-content="options_page_tab_options_style_sideways"></option>
				</select>
				<button onclick="saveStyle()" i18n-content="options_page_tab_options_button_save"></button>
				<span id="status_style"></span>
				<br/>			
		
				<!-- Preview pane -->
				<div id="fake_omnibar">
					<div id="controls-left">
						&nbsp;<span id="world_icon"></span>
					</div>
					<a href="http://www.deezer.com" target="_blank">www.deezer.com</a>
					<div id="controls-right">
						&nbsp;<span id="star_icon"></span>
					</div>
				</div>
				<div id="extension_icon"></div>
				<div id="preview">
					<span id="arrow_preview"></span>
					<div id="preview_outer_border">
						<div id="preview_inner_border">
							<div id="popup_display" style="display: inline-block;">
								<div id="controls">
									<div id="controls-left">
										&nbsp;
									</div>
									<div id="controls-right">
										&nbsp;<a href="javascript:void(0)" onclick="executePlayerAction('prev'); return false;" id="control-prev"></a><a href="javascript:void(0)" onclick="executePlayerAction('pause'); return false;" id="control-pause"></a><a href="javascript:void(0)" onclick="executePlayerAction('play'); return false;" id="control-play"></a><a href="javascript:void(0)" onclick="executePlayerAction('next'); return false;" id="control-next"></a>
									</div>
								</div>
								<div id="now_playing">
									<div id="now_playing_info">
										<span id="now_playing_info_track"></span>
										<span id="now_playing_info_artist"></span>
										<!-- span id="now_playing_info_album"></span -->
									</div>
			 						<img src="imgs/logo_deezer.png" id="cover"/>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		
			<!-- Option tab: notifications -->
			<section id="notifications">
				<h1 i18n-content="options_page_tab_options_h1_notifications"></h1>
				<fieldset>
					<div>
						<label for="notifs_activate" i18n-content="options_page_tab_notifs_activate_permission"></label>
						<input type="checkbox" onchange="checkNotifsPermission()" id="notifs_activate"></input>
					</div>
					
					<div>					
						<label for="notifs_always_visible" i18n-content="options_page_tab_notifs_always_visible"></label>
						<input type="checkbox" onchange="showHideNotifsOptions()" id="notifs_always_visible"></input>
					</div>
					
					<div>
						<label for="notifs_fade_away_delay" i18n-content="options_page_tab_notifs_fade_away_delay"></label>
						<input onchange="showHideNotifsOptions()" type="range" id="notifs_fade_away_delay" min="1" max="10" step="0.5" value="3"></input>
						<span id="notifs_fade_away_delay_display"></span>
					</div>
					
					<div style="margin: 15px 0px 0px -5px;">
						<button onclick="saveNotifications()" i18n-content="options_page_tab_options_button_save"></button>
						<span id="status_notifs"></span>
					</div>
				</fieldset>
			</section>
		</div>
			
		<!-- footer -->
		<footer>
			<div i18n-content="options_page_footer_not_endorsed"></div>
			<div><a i18n-content="options_page_footer_contact" href="mailto:m520152112e@gmail.com" target="_blank"></a> | <a i18n-content="options_page_footer_donate" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=K5THDKB5BN992" target="_blank"></a> <span i18n-content="options_page_footer_via_paypal"></span></div>
		</footer>
	</body>
</html>
























