<!doctype html>
<html>
	<head>
		<title>Deezer Control</title>
		<link type="text/css" rel="stylesheet" href="/css/options.css"/>
		<link type="text/css" rel="stylesheet" href="/css/large/popup.css" id="popup_style_css"/>
		<script src="/scripts/popup.js"></script>
		<script src="/scripts/i18n.js"></script>
		<script src="/scripts/localstorage.js"></script>
		<script src="/scripts/hotkeys.js"></script>
		<script src="/scripts/jquery-1.7.2.min.js"></script>
		<script type="text/javascript">
		 <!--
		 function convertKeyCode(iKeyCode, iPrintedValue)
		 {
			 var aMapKeyToText = {
					   8: "keycode_text_backspace", 
					   9: "keycode_text_tab",  
					  13: "keycode_text_enter",  
					  16: "keycode_text_shift",  
					  17: "keycode_text_ctrl",  
					  18: "keycode_text_alt",  
					  19: "keycode_text_pause_break",  
					  20: "keycode_text_caps_lock",  
					  27: "keycode_text_escape",  
					  32: "keycode_text_space",  
					  33: "keycode_text_page_up",  
					  34: "keycode_text_page_down",  
					  35: "keycode_text_end",  
					  36: "keycode_text_home",  
					  37: "keycode_text_left_arrow",  
					  38: "keycode_text_up_arrow",  
					  39: "keycode_text_right_arrow",   
					  40: "keycode_text_down_arrow",   
					  42: "keycode_text_print_screen",   
					  45: "keycode_text_insert",   
					  46: "keycode_text_delete",   
					  91: "keycode_text_left_window_key",   
					  92: "keycode_text_right_window_key",   
					  93: "keycode_text_select_key",   
					  96: "keycode_text_numpad_0",   
					  97: "keycode_text_numpad_1",    
					  98: "keycode_text_numpad_2",    
					  99: "keycode_text_numpad_3",   
					 100: "keycode_text_numpad_4",    
					 101: "keycode_text_numpad_5",   
					 102: "keycode_text_numpad_6",     
					 103: "keycode_text_numpad_7",     
					 104: "keycode_text_numpad_8",     
					 105: "keycode_text_numpad_9",     
					 106: "keycode_text_numpad_multiply",     
					 107: "keycode_text_numpad_plus",     
					 109: "keycode_text_numpad_minus",     
					 110: "keycode_text_numpad_dot",     
					 111: "keycode_text_numpad_slash",     
					 112: "keycode_text_F1",     
					 113: "keycode_text_F2",          
					 114: "keycode_text_F3",          
					 115: "keycode_text_F4",          
					 116: "keycode_text_F5",          
					 117: "keycode_text_F6",          
					 118: "keycode_text_F7",          
					 119: "keycode_text_F8",          
					 120: "keycode_text_F9",          
					 121: "keycode_text_F10",          
					 122: "keycode_text_F11",          
					 123: "keycode_text_F12",          
					 144: "keycode_text_num_lock",       
					 145: "keycode_text_scroll_lock",  
					 176: "keycode_text_media_key_next",  
					 177: "keycode_text_media_key_prev",  
					 178: "keycode_text_media_key_stop",  
					 179: "keycode_text_media_key_play",  
					 186: "keycode_text_semi_column",  
					 187: "keycode_text_equal",  
					 188: "keycode_text_coma",  
					 189: "keycode_text_minus", 
					 190: "keycode_text_dot",  
					 191: "keycode_text_slash",  
					 192: "keycode_text_grave",  
					 219: "keycode_text_left_bracket",  
					 220: "keycode_text_back_slash",  
					 221: "keycode_text_right_bracket",  
					 222: "keycode_text_quote"
			 }
			 
			 if (aMapKeyToText.hasOwnProperty(iKeyCode)) 
				 return chrome.i18n.getMessage(aMapKeyToText[iKeyCode]);
			 
			return String.fromCharCode(iKeyCode);
		 }
		 //-->
		</script>
		<script type="text/javascript">	
			// Saves options to localStorage.
			function saveStyle() 
			{
				LOCSTO.popupStyle = $("#popup_style").val();
				LOCSTO.saveOptions();
			
				// Update status to let user know options were saved.
				$("#status_style").text(chrome.i18n.getMessage("options_page_options_saved"));
				setTimeout(function() { $("#status_style").text(""); }, 750);
			}
			
			function saveNotifications() 
			{
		    	var aNotifsShowWhen = $('input:radio[name="notifs_show_when"]:checked').val();
		    	var aNotifsDelay = $('#notifs_fade_away_delay').val() * 1000;
		    	
		    	// the key names are due to the old notifications system
		    	if (aNotifsShowWhen == 'never')
		    		LOCSTO.notifications = { never: true, alwaysOn: false, visible: false, onHotKeyOnly: false, fadeAwayDelay: aNotifsDelay };
		    	
		    	else if (aNotifsShowWhen == 'never_hides')
		    		LOCSTO.notifications = { never: false, alwaysOn: true, visible: false, onHotKeyOnly: false, fadeAwayDelay: aNotifsDelay };
		    	
		    	else if (aNotifsShowWhen == 'on_song_change')
		    		LOCSTO.notifications = { never: false, alwaysOn: false, visible: true, onHotKeyOnly: false, fadeAwayDelay: aNotifsDelay };
		    	
		    	else if (aNotifsShowWhen == 'on_hotkey_only')
		    		LOCSTO.notifications = { never: false, alwaysOn: false, visible: false, onHotKeyOnly: true, fadeAwayDelay: aNotifsDelay }; 

		    	LOCSTO.saveOptions();
			
				// Update status_style to let user know options were saved.
				$("#status_notifs").text(chrome.i18n.getMessage("options_page_options_saved"));
				setTimeout(function() { $("#status_notifs").text(""); }, 750);
				
				// reshow notifs so that the user sees the change straight away
				chrome.extension.sendRequest({ type: "showNotif", source: "options" });
			}
			
			function saveHotKeys()
			{
		    	storeHotKey('prevHotKey');
		    	storeHotKey('playPauseHotKey');
		    	storeHotKey('nextHotKey');
		    	storeHotKey('whatZatSongHotKey');
				
				LOCSTO.saveOptions();
			
				// Update status to let user know options were saved.
				$("#status_hotkeys").text(chrome.i18n.getMessage("options_page_options_saved"));
				setTimeout(function() { $("#status_hotkeys").text(""); }, 750);
			}
		    
		    function storeHotKey(iHotKeyName)
		    {
				var aHotKeySelect = $("#" + iHotKeyName);
				
				LOCSTO[iHotKeyName].shiftKey = aHotKeySelect.children('button:eq(0)').hasClass('two_state_selected');
				LOCSTO[iHotKeyName].ctrlKey  = aHotKeySelect.children('button:eq(1)').hasClass('two_state_selected');
				LOCSTO[iHotKeyName].altKey   = aHotKeySelect.children('button:eq(2)').hasClass('two_state_selected');
				LOCSTO[iHotKeyName].keyCode  = aHotKeySelect.children('input:eq(1)').val();
		    }
		
			// Restores select box state to saved value from localStorage.
			function restore_options() 
			{
				//           Popup style
				//--------------------------------
				$("#popup_style").val(LOCSTO.popupStyle);
				loadStyle(); // from popup.js
				
				
				//        Notifications
				//--------------------------------
				if (LOCSTO.notifications.alwaysOn)
					$('input:radio[name="notifs_show_when"]').filter('[value="never_hides"]').prop('checked', true);
				else if (LOCSTO.notifications.visible)
					$('input:radio[name="notifs_show_when"]').filter('[value="on_song_change"]').prop('checked', true);
				else if (LOCSTO.notifications.onHotKeyOnly)
					$('input:radio[name="notifs_show_when"]').filter('[value="on_hotkey_only"]').prop('checked', true);
				else
					$('input:radio[name="notifs_show_when"]').filter('[value="never"]').prop('checked', true);
					
				$('#notifs_fade_away_delay').val(LOCSTO.notifications.fadeAwayDelay / 1000);
				
				updateNotifsOptions(); // ensure options are correctly shown
				
				
				//        Hot keys
				//--------------------------------
				// hot keys are activated only if we have permission on all tabs
				// if we don't permission, show an explanation
				showHotKeys();
			}
			
			function showHotKeys()
			{
				chrome.permissions.contains(
				{ origins: ['<all_urls>'] }, 
				function(result) 
				{
				    if (result)
				    {
				    	$("#hotkey_permission_ko").css('display', 'none');
				    	$("#hotkey_permission_ok").css('display', 'block');
				    	
						restore_hot_key('prevHotKey');
						restore_hot_key('playPauseHotKey');
						restore_hot_key('nextHotKey');
						restore_hot_key('whatZatSongHotKey');
				    }
				    else
			    	{
				    	$("#hotkey_permission_ko").css('display', 'block');
				    	$("#hotkey_permission_ok").css('display', 'none');
			    	}
				});
			}
		
			function restore_hot_key(iHotKeyName)
			{
				var aHotKeySelect = $("#" + iHotKeyName);
				
				// on click, all button are selected 
				aHotKeySelect.children('button').click(function() { $(this).toggleClass('two_state_selected two_state_unselected') });
				aHotKeySelect.children('span').css('visibility', 'visible');
				
				// last button: click reveals the textbox to enter new key
				aHotKeySelect.children('button:eq(3)').unbind('click').click(function() 
				{
					$(this).parent().children('span').text("");
					$(this).css('display', 'none');
					$(this).parent().children('input:eq(0)').css('display', 'inline').focus();
				});

				// on key up in the input box, update last button with the new key code
				aHotKeySelect.children('input:eq(0)').keydown(function() 
				{ 
					// if ctrl, shift or alt, prevent update and warn user
					if (event.keyCode >= 16 && event.keyCode <= 18)
					{
						$(this).parent().children('span').text(chrome.i18n.getMessage("options_page_tab_hotkeys_warning_illegal_hotkey"));
					}
					else
					{
						$(this).parent().children('button:eq(3)').text(convertKeyCode(event.keyCode, $(this).val())); 
						$(this).next().val(event.keyCode);
					}

					// redisplay
					$(this).parent().children('button:eq(3)').css('display', 'inline').focus().blur();
					$(this).css('display', 'none').val("");
				});
				
				aHotKeySelect.children('input:eq(0)').blur(function() 
				{ 
					$(this).css('display', 'none').val("");
					$(this).parent().children('button:eq(3)').css('display', 'inline').focus().blur();
				});
				
								
				// create display
				aHotKeySelect.children('button:eq(0)').toggleClass('two_state_unselected', !LOCSTO[iHotKeyName].shiftKey).toggleClass('two_state_selected', LOCSTO[iHotKeyName].shiftKey);
				aHotKeySelect.children('button:eq(1)').toggleClass('two_state_unselected', !LOCSTO[iHotKeyName].ctrlKey).toggleClass('two_state_selected', LOCSTO[iHotKeyName].ctrlKey);
				aHotKeySelect.children('button:eq(2)').toggleClass('two_state_unselected', !LOCSTO[iHotKeyName].altKey).toggleClass('two_state_selected', LOCSTO[iHotKeyName].altKey);
				aHotKeySelect.children('button:eq(3)').text(convertKeyCode(LOCSTO[iHotKeyName].keyCode));
				
				aHotKeySelect.children('input').attr('size', '3').css('display', 'none');
				aHotKeySelect.children('input:eq(1)').val(LOCSTO[iHotKeyName].keyCode);
			}
			
			function loadStyleFromSelect()
			{
				loadStyle($("#popup_style").val()); // from popup.js
			}
			
		    function showSection(id)
		    {
		    	$('#tab_chooser > nav > a').removeClass('currentone');
		    	$('#center_block > section').removeClass('currentone');
		    	$('#' + id).addClass('currentone');
		    	$('#' + id + '_nav').addClass('currentone');

				var aNewLeft = $('#' + id + '_nav').position().left - $('#tab_chooser > nav > a:first').position().left + 73;
				$('#arrow_line > img').css('left', aNewLeft + 'px');
			}
		    
		    function resetSections()
		    {
		    	$('#tab_chooser > nav > a:first').addClass('currentone');
		    	$('#center_block > section:first').addClass('currentone');
				if(location.hash)
					showSection(location.hash.replace(/^\#/, ''));
		    }
		    
		    function preparePage()
		    {
		    	restore_options(); 
		    	refreshPopup(); 
		    	resetSections(); 
		    	i18n.process(document);
		    	
		    	$("#rate_button").attr('href', "https://chrome.google.com/webstore/detail/" + chrome.i18n.getMessage("@@extension_id"));
		    }
		    
		    function checkNotifsPermissions()
		    {
		    	var aNotifsShowWhen = $('input:radio[name="notifs_show_when"]:checked').val();
		    	if (aNotifsShowWhen != "never")
	    		{
		    		chrome.permissions.request({ permissions: ['notifications'] }, function(granted) 
    				{
		    			if (!granted)
	    				{
		    				$('#chrome_permission_not_granted').css("visibility", "visible");  
							$('input:radio[name="notifs_show_when"]').filter('[value="never"]').prop('checked', true);
	    				}
	    		  	});
	    		}

				updateNotifsOptions();
		    }
		    
		    function updateNotifsOptions()
		    {
		    	var aNotifsShowWhen = $('input:radio[name="notifs_show_when"]:checked').val();
		    	
		    	if (aNotifsShowWhen == 'on_hotkey_only' || aNotifsShowWhen == 'on_song_change')
		    		$('#notifs_fade_away_delay').parent().css('display', 'block');
		    	else
		    		$('#notifs_fade_away_delay').parent().css('display', 'none');
		    	
		    	$('#notifs_fade_away_delay_display').text($('#notifs_fade_away_delay').val());
		    }
		    
		    function activateHotKeys(e)
		    {
		    	chrome.permissions.request({ origins: [ '<all_urls>' ] }, function(granted) 
    			{
		    		showHotKeys();
		    	});
		    }
		    
		    window.addEventListener('hashchange', function(e) { showSection(location.hash.replace(/^\#/,'')); });
		</script>
	</head>

	<body onload="preparePage();">
		<div id="tab_chooser">
			<nav>
				<a id="welcome_nav" href="#welcome" data-i18n-content="options_page_tab_title_welcome"></a><a id="options_nav" href="#options" data-i18n-content="options_page_tab_title_options"></a><a id="hotkeys_nav" href="#hotkeys" data-i18n-content="options_page_tab_title_hotkeys"></a><a id="notifications_nav" href="#notifications" data-i18n-content="options_page_tab_title_notifications"></a>
			</nav>
			<span id="arrow_line"><img src="imgs/arrow_down.png"/></span>
		</div>
			
		<div id="center_block">
		
			<!-- Option tab: welcome -->
			<section id="welcome">
				<h1 data-i18n-content="options_page_tab_welcome_h1"></h1>
				<div data-i18n-content="options_page_tab_welcome_content"></div>
				<div id="remember_to">
					<h2 data-i18n-content="options_page_tab_welcome_remember_to"></h2>
					<div><a id="rate_button" data-i18n-content="options_page_tab_welcome_rate_button" target="_blank"></a><span data-i18n-content="options_page_tab_welcome_rate_label"></span></div>
					<div><a data-i18n-content="options_page_tab_welcome_donate_button" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=K5THDKB5BN992" target="_blank"></a><span data-i18n-content="options_page_tab_welcome_donate_label"></span></div>
				</div>
				<div><span data-i18n-content="options_page_tab_welcome_contact_me_at"></span>: <a href="mailto:m520152112e@gmail.com" target="_blank">m520152112e@gmail.com</a></div>
			</section>
		
			<!-- Option tab: style chooser -->
			<section id="options">
				<h1 data-i18n-content="options_page_tab_popup_style_h1"></h1>
				<span data-i18n-content="options_page_tab_popup_style_choose_style"></span>:
				<select id="popup_style" onchange="loadStyleFromSelect()">
		 			<option value="large" data-i18n-content="options_page_tab_popup_style_style_large"></option>
		 			<option value="small" data-i18n-content="options_page_tab_popup_style_style_small"></option>
		 			<option value="sideways" data-i18n-content="options_page_tab_popup_style_style_sideways"></option>
				</select>
				<button onclick="saveStyle()" data-i18n-content="options_page_button_save"></button>
				<span id="status_style"></span>
				<br/>			
		
				<!-- Preview pane -->
				<div id="fake_omnibar">
					<div id="controls-left">
						&nbsp;<span id="world_icon"></span>
					</div>
					<a href="http://www.deezer.com" target="_blank">www.deezer.com</a>
					<div id="controls-right">
						&nbsp;<span id="star_icon"></span>
					</div>
				</div>
				<div id="extension_icon"></div>
				<div id="preview">
					<span id="arrow_preview"></span>
					<div id="preview_outer_border">
						<div id="preview_inner_border">
							<div id="popup_display" style="display: inline-block;">
								<div id="controls">
									<div id="controls-left">
										&nbsp;
									</div>
									<div id="controls-right">
										&nbsp;<a href="javascript:void(0)" onclick="executePlayerAction('prev'); return false;" id="control-prev"></a><a href="javascript:void(0)" onclick="executePlayerAction('pause'); return false;" id="control-pause"></a><a href="javascript:void(0)" onclick="executePlayerAction('play'); return false;" id="control-play"></a><a href="javascript:void(0)" onclick="executePlayerAction('next'); return false;" id="control-next"></a>
									</div>
								</div>
								<div id="now_playing">
									<div id="now_playing_info">
										<span id="now_playing_info_track"></span>
										<span id="now_playing_info_artist"></span>
										<!-- span id="now_playing_info_album"></span -->
									</div>
			 						<img src="imgs/unknown_cd.png" id="cover"/>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		
			<!-- Option tab: hot keys -->
			<section id="hotkeys">
				<h1 data-i18n-content="options_page_tab_hotkeys_h1"></h1>
				<div data-i18n-content="options_page_tab_hotkeys_what_are_hotkeys"></div>
				<div id="hotkey_permission_ko">
					<div data-i18n-content="options_page_tab_hotkeys_activation_hot_keys"></div>
					<button onclick="activateHotKeys();" data-i18n-content="options_page_tab_hotkeys_button_activate"></button>
				</div>
				
				<fieldset id="hotkey_permission_ok">
					<h2 data-i18n-content="options_page_tab_hotkeys_prevHotKey_h2"></h2>
					<div id="prevHotKey">
						<button class="two_state_unselected">SHIFT</button>
						<button class="two_state_unselected">CTRL</button>
						<button class="two_state_unselected">ALT</button>
						<button class="two_state_selected"></button>
						<input type="text"></input>
						<input type="text"></input>
						<span class="warning"></span>
					</div>
					
					<h2 data-i18n-content="options_page_tab_hotkeys_playPauseHotKey_h2"></h2>
					<div id="playPauseHotKey">
						<button class="two_state_unselected">SHIFT</button>
						<button class="two_state_unselected">CTRL</button>
						<button class="two_state_unselected">ALT</button>
						<button class="two_state_selected"></button>
						<input type="text"></input>
						<input type="text"></input>
						<span class="warning"></span>
					</div>
										
					<h2 data-i18n-content="options_page_tab_hotkeys_nextHotKey_h2"></h2>
					<div id="nextHotKey">
						<button class="two_state_unselected">SHIFT</button>
						<button class="two_state_unselected">CTRL</button>
						<button class="two_state_unselected">ALT</button>
						<button class="two_state_selected"></button>
						<input type="text"></input>
						<input type="text"></input>
						<span class="warning"></span>
					</div>
										
					<h2 data-i18n-content="options_page_tab_hotkeys_whatZatSongHotKey_h2"></h2>
					<div style="margin-top: -10px; font-style: italic;" data-i18n-content="options_page_tab_hotkeys_warning_whatZatSongHotKey"></div>
					<div id="whatZatSongHotKey">
						<button class="two_state_unselected">SHIFT</button>
						<button class="two_state_unselected">CTRL</button>
						<button class="two_state_unselected">ALT</button>
						<button class="two_state_selected"></button>
						<input type="text"></input>
						<input type="text"></input>
						<span class="warning"></span>
					</div>

					<div class="save_cancel_bar">
						<button id="save_hot_keys" onclick="saveHotKeys();" data-i18n-content="options_page_button_save"></button>
						<span id="status_hotkeys"></span>
					</div>
				</fieldset>
			</section>
		
			<!-- Option tab: notifications -->
			<section id="notifications">
				<h1 data-i18n-content="options_page_tab_notifs_h1"></h1>
				<div data-i18n-content="options_page_tab_notifs_what_are_notifications"></div>
				
				<fieldset>
					<h2 data-i18n-content="options_page_tab_notifs_show_notifs_when_title"></h2>
					<input type="radio" name="notifs_show_when" value="never" onclick="checkNotifsPermissions();"/><span data-i18n-content="options_page_tab_notifs_show_never"></span><span class="warning" id='chrome_permission_not_granted' data-i18n-content="options_page_tab_notifs_chrome_permission_not_granted"></span><br/>
					<input type="radio" name="notifs_show_when" value="never_hides" onclick="checkNotifsPermissions();"/><span data-i18n-content="options_page_tab_notifs_show_never_hides"></span><br/>
					<input type="radio" name="notifs_show_when" value="on_song_change" onclick="checkNotifsPermissions();"/><span data-i18n-content="options_page_tab_notifs_show_on_song_change"></span><br/>
					<input type="radio" name="notifs_show_when" value="on_hotkey_only" onclick="checkNotifsPermissions();"/><span data-i18n-content="options_page_tab_notifs_show_on_hotkey_only"></span><br/>
					
					<div>
						<label for="notifs_fade_away_delay" data-i18n-content="options_page_tab_notifs_fade_away_delay"></label>
						<input onchange="updateNotifsOptions()" type="range" id="notifs_fade_away_delay" min="1" max="10" step="0.5" value="3"></input>
						<span id="notifs_fade_away_delay_display"></span>
					</div>
					
					<div class="save_cancel_bar">
						<button onclick="saveNotifications();" data-i18n-content="options_page_button_save"></button>
						<span id="status_notifs"></span>
					</div>
				</fieldset>
			</section>
		</div>
			
		<!-- footer -->
		<footer>
			<div data-i18n-content="options_page_footer_not_endorsed"></div>
			<div><a data-i18n-content="options_page_footer_contact" href="mailto:m520152112e@gmail.com" target="_blank"></a> | <a data-i18n-content="options_page_footer_donate" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=K5THDKB5BN992" target="_blank"></a> <span data-i18n-content="options_page_footer_via_paypal"></span></div>
		</footer>
	</body>
</html>
























